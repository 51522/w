opkg update && opkg install dnscrypt-proxy2

#to dnscrypt-proxy.toml
listen_addresses = ['127.0.0.53:53']
block_undelegated = true

#Check that the proxy is properly installed
#Type:
dnscrypt-proxy -config /etc/dnscrypt-proxy2/dnscrypt-proxy.toml -check

#Configure dnsmasq to forget about ISP's DNS and only use DNSCrypt
#If you're using an OpenWRT version built before 23 February 2019,
#you need to update dnsmasq, since its option localuse was added on 23 Feb 2019:
opkg update; opkg upgrade dnsmasq

#Edit /etc/config/dhcp to disable resolv.conf and only use the dedicated DNSCrypt resolver:

config dnsmasq
    ...
    # Ignore ISP's DNS:
    option noresolv '1'
    # Change /etc/resolv.conf to direct local router processes to use local dnsmasq:
    option localuse '1'
    # Don't forward RFC 1918 private addresses and RFC 6761 top level domains
    option boguspriv '1'
    # Upstream dnscrypt-proxy resolver to use for queries:
    list server '127.0.0.53'

#Restart dnsmasq to switch to the new configuration:
/etc/init.d/dnsmasq restart

#Check system log for any errors reported by dnsmasq:
logread -l 100 | grep dnsmasq

#It should report this: daemon.info dnsmasq[PID]: using nameserver 127.0.0.53#53

#Prevent clients on the local network from using external DNS servers
#Create firewall rules for redirecting all detectable DNS requests from lan zone clients to dnscrypt-proxy by adding the following rules into /etc/config/firewall:

config redirect
    option name 'Divert-DNS, port 53'
    option src 'lan'
    option proto 'tcp udp'
    option src_dport '53'
    option dest_port '53'
    option target 'DNAT'

config redirect
    option name 'Divert-DNS, port 853'
    option src 'lan'
    option proto 'tcp udp'
    option src_dport '853'
    option dest_port '853'
    option target 'DNAT'

config redirect
    option name 'Divert-DNS, port 5353'
    option src 'lan'
    option proto 'tcp udp'
    option src_dport '5353'
    option dest_port '5353'
    option target 'DNAT'

#And reload Firewall:
/etc/init.d/firewall reload

#Note: Alternatively, if you are using the adblock package you can enable the
#Force Local DNS option which will create these rules automatically for you.

#Make sure that the files you added are backed up
#Using the LUCI web interface:
#In the System/Backup/Flash page, click the Configuration tab and add
the list of files you uploaded and the automatically generated rc.d symlink to
restore its enabled status after a sysupgrade:

/etc/init.d/dnscrypt-proxy
/usr/sbin/dnscrypt-proxy
/etc/rc.d/S18dnscrypt-proxy

#Configuration files in /etc/config are automatically saved already.
#Using the command line:
#Edit /etc/sysupgrade.conf to add files to be included in backups.